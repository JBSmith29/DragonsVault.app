{% extends "base.html" %}
{% block title %}API Access - DragonsVault{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-xl-8">
    <div class="card shadow border-0">
      <div class="card-body p-4">
        <h1 class="h4 mb-3">API access</h1>
        <p class="text-muted">
          Use API tokens for CLI scripts or automation that needs to hit protected endpoints like <code>/import</code> or <code>/admin</code>.
          Tokens act as passwords&mdash;store them securely and rotate them if leaked.
        </p>
        <p class="text-muted mb-4">
          Send tokens via the <code>Authorization: Bearer &lt;token&gt;</code> header; querystring tokens are rejected for safety.
        </p>

        {% if issued_token %}
          <div class="alert alert-warning">
            <strong>Copy your token now:</strong>
            <code class="d-block mt-2 text-break">{{ issued_token }}</code>
          </div>
        {% endif %}

        <dl class="row">
          <dt class="col-sm-3">Current token</dt>
          <dd class="col-sm-9">
            {% if token_hint %}
              Active (ends with <strong>{{ token_hint }}</strong>, issued {{ token_created_at or 'unknown' }})
            {% else %}
              <span class="text-muted">None</span>
            {% endif %}
          </dd>
        </dl>

        <form method="post" class="d-flex gap-2">
          <input type="hidden" name="action" value="create">
          <button class="btn btn-primary" type="submit">Generate new token</button>
        </form>
        <form method="post" class="d-inline" style="display:inline-block;">
          <input type="hidden" name="action" value="revoke">
          <button class="btn btn-outline-danger mt-3" type="submit" {% if not token_hint %}disabled{% endif %}>
            Revoke existing token
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
