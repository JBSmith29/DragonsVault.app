{% extends "base.html" %}
{% block title %}Game {{ game.id }}{% endblock %}
{% block content %}
<style>
  .detail-card { border: 1px solid var(--bs-border-color); border-radius: 0.85rem; padding: 1rem 1.1rem; background: rgba(255,255,255,0.02); }
  .seat-row { border: 1px solid var(--bs-border-color); border-radius: 0.7rem; padding: 0.8rem; margin-bottom: 0.75rem; background: rgba(255,255,255,0.02); }
  .seat-row:last-child { margin-bottom: 0; }
  .seat-meta { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.4rem; }
  .seat-meta .badge { font-size: 0.72rem; }
  .commander-hover { cursor: pointer; text-decoration: underline dotted; text-underline-offset: 2px; }
</style>

<div class="container py-4">
  <div class="d-flex flex-wrap align-items-start justify-content-between gap-3 mb-4">
    <div>
      <h1 class="mb-1">Game Details</h1>
      <p class="text-muted mb-0">Played {{ game.played_at_label }}</p>
    </div>
    <div class="d-flex flex-wrap align-items-center gap-2">
      {% if can_edit %}
        <a class="btn btn-primary btn-sm" href="{{ url_for('views.games_edit', game_id=game.id) }}">Edit Game</a>
        <form method="post" action="{{ url_for('views.games_delete', game_id=game.id) }}" onsubmit="return confirm('Delete this game log?');">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-outline-danger btn-sm" type="submit">Delete</button>
        </form>
      {% endif %}
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('views.games_overview') }}">Back to Logs</a>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-12 col-md-4">
      <div class="detail-card">
        <div class="text-muted small">Players</div>
        <div class="fw-semibold">{{ game.seat_count }}</div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="detail-card">
        <div class="text-muted small">Winner</div>
        <div class="fw-semibold">{{ game.winner_label or '—' }}</div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="detail-card">
        <div class="text-muted small">Win type</div>
        <div class="fw-semibold">{{ 'Infinite combo' if game.win_via_combo else '—' }}</div>
      </div>
    </div>
    <div class="col-12">
      <div class="detail-card">
        <div class="text-muted small">Notes</div>
        <div class="fw-semibold">{{ game.notes if game.notes else '—' }}</div>
      </div>
    </div>
  </div>

  <div class="detail-card">
    <h2 class="h6 text-uppercase text-muted mb-3">Seats</h2>
    {% for seat in game.seats %}
      <div class="seat-row">
        <div class="seat-meta">
          <span class="badge text-bg-secondary">Seat {{ seat.seat_number }}</span>
          <span class="text-muted small">Turn {{ seat.turn_order }}</span>
          {% if seat.is_winner %}
            <span class="badge text-bg-success">Winner</span>
          {% endif %}
          {% if seat.is_winner and game.win_via_combo %}
            <span class="badge text-bg-warning">Combo win</span>
          {% endif %}
        </div>
        <div class="fw-semibold">{{ seat.player_label }}</div>
        <div class="small text-muted">
          {{ seat.deck_name }}
          {% if seat.commander_name %}
            · <span class="commander-hover"
                    {% if seat.commander_image %}data-hover-src="{{ seat.commander_image }}"{% endif %}
                    data-card-name="{{ seat.commander_name }}">{{ seat.commander_name }}</span>
          {% endif %}
        </div>
        <div class="small text-muted">
          Bracket: {{ seat.bracket_level or '—' }}{% if seat.bracket_label %} · {{ seat.bracket_label }}{% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
